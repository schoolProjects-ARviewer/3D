<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Viewer WV</title>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>  <!-- QR Scanner Library -->
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        model-viewer { width: 100%; height: 500px; }
        button { margin: 10px; padding: 10px 20px; font-size: 16px; cursor: pointer; }
        #qr-reader-container { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); text-align: center; }
        #qr-reader { width: 300px; margin-top: 50px; }
    </style>
</head>
<body>

    <h1>Scan een QR-code om een model te laden - optimized 3</h1>

    <!-- Model Viewer -->
    <model-viewer id="ar-viewer"
        src=""  <!-- Laat leeg, wordt later geladen -->
        auto-rotate camera-controls ar ar-modes="webxr scene-viewer quick-look">
    </model-viewer>

    <br>

    <!-- Knoppen -->
    <button onclick="openQRScanner()">üì∑ Scan QR-code</button>
    <button onclick="startAR()">üîÆ Bekijk in AR</button>

    <!-- QR-code scanner scherm -->
    <div id="qr-reader-container">
        <div id="qr-reader"></div>
        <button onclick="closeQRScanner()">‚ùå Annuleren</button>
    </div>

    <script>
        let qrScanner;

        function openQRScanner() {
            document.getElementById("qr-reader-container").style.display = "block";

            qrScanner = new Html5Qrcode("qr-reader");
            qrScanner.start(
                { facingMode: "environment" }, // Achterste camera voor telefoons
                { fps: 10, qrbox: 250 },
                (decodedText) => {
                    let modelViewer = document.getElementById("ar-viewer");

                    if (decodedText.startsWith("https://")) {
                        modelViewer.src = decodedText;
                        console.log("Model geladen:", decodedText);
                        closeQRScanner(); // Scanner sluiten na succesvol scannen
                    }
                },
                (errorMessage) => {
                    console.log("Scanning...", errorMessage);
                }
            );
        }

        function closeQRScanner() {
            if (qrScanner) {
                qrScanner.stop().then(() => {
                    document.getElementById("qr-reader-container").style.display = "none";
                }).catch((err) => console.log("Fout bij stoppen scanner:", err));
            }
        }

        function startAR() {
            let modelViewer = document.getElementById("ar-viewer");
            modelViewer.activateAR();
        }
    </script>

</body>
</html>
